---
- name: Create swap file
  run_once: true
  command: dd if=/dev/zero of=/swapfile bs=1024 count=1000k creates="/swapfile"
  tags:
    - swap.file.create


- name: Change swap file permissions
  run_once: true
  file: path="/swapfile"
        owner=root
        group=root
        mode=0600
  tags:
    - swap.file.permissions


- name: "Check swap file type"
  run_once: true
  command: file /swapfile
  register: swapfile
  tags:
    - swap.file.mkswap


- name: Make swap file
  run_once: true
  become: true
  command: "mkswap /swapfile"
  tags:
    - swap.file.mkswap


- name: Write swap entry in fstab
  run_once: true
  mount: name=none
        src=/swapfile
        fstype=swap
        opts=sw
        passno=0
        dump=0
        state=present
  tags:
    - swap.fstab


- name: Mount swap
  run_once: true
  command: "swapon /swapfile"
  when: ansible_swaptotal_mb < 1
  tags:
    - swap.file.swapon